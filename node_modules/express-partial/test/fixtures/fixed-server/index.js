var jade = require('jade');
var expressPartial = require('../../../lib/express-partial');

function setup(req, res, next) {
  var app = req.app;
  app.engine('jade', jade.__express);
  app.set('view engine', 'jade');
  app.set('views', './test/fixtures/templates');
  next();
}

exports['GET 200 /render'] = {
  method: 'get',
  route: '/render',
  response: [
    setup,
    expressPartial(),
    function (req, res) {
      res.renderPartials({
        'hello-world': { name: 'World' }
      });
    }
  ]
};

exports['GET 200 /render-multiple'] = {
  method: 'get',
  route: '/render-multiple',
  response: [
    setup,
    expressPartial(),
    function (req, res) {
      res.renderPartials({
        'hello-world': { name: 'World' },
        'name': { name: 'Joe Strummer' }
      });
    }
  ]
};

exports['GET 200 /callback'] = {
  method: 'get',
  route: '/callback',
  response: [
    setup,
    expressPartial(),
    function (req, res) {
      res.renderPartials({
        'hello-world': { name: 'World'}
      }, function (err, rendered) {
        res.send({ hello: rendered['hello-world'] });
      });
    }
  ]
};
